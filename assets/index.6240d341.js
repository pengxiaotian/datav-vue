import{a6 as i,aa as r,ad as n,a4 as V,a_ as E,a9 as h,aB as L,a5 as t,aX as s,a$ as c,ag as U,ah as B,ab as b,aN as C}from"./vendor.1c7e0fbb.js";import{a as z,U as M,b as S}from"./AppRoot.9161bc33.js";import{u as D,p as N,v as T,g as H}from"./qiniu.733031a3.js";const A={},j={t:"1639127743337",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3985",width:"64",height:"64"},O=n("path",{d:"M558.434375 667.221875a28.51875 28.51875 0 0 1 0 40.33125l-181.490625 181.490625a57.0375 57.0375 0 0 1-80.6625 0L134.95625 727.71875a57.0375 57.0375 0 0 1 0-80.6625l181.490625-181.490625a28.51875 28.51875 0 1 1 40.33125 40.33125l-181.490625 181.490625 161.325 161.325 181.490625-181.490625a28.51875 28.51875 0 0 1 40.33125 0z m60.496875-262.153125a28.51875 28.51875 0 0 1 0 40.33125l-201.65625 201.65625a28.51875 28.51875 0 0 1-40.33125-40.33125l201.65625-201.65625a28.51875 28.51875 0 0 1 40.33125 0z m241.9875-80.6625a57.0375 57.0375 0 0 1 0 80.6625l-181.490625 181.490625a28.51875 28.51875 0 1 1-40.33125-40.33125l181.490625-181.490625-161.325-161.325-181.490625 181.490625a28.51875 28.51875 0 1 1-40.33125-40.33125l181.490625-181.490625a57.0375 57.0375 0 0 1 80.6625 0l161.325 161.325z","p-id":"3986"},null,-1),q=[O];function G(e,a){return i(),r("svg",j,q)}var J=z(A,[["render",G]]);const P={},X={t:"1632393445506",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"4073",width:"64",height:"64"},K=n("path",{d:"M956.677 843.679c-2.693 50.048-68.034 38.343-102.164 38.343H127.867c-13.491 0-26.389 1.214-38.835-5.232-20.091-10.414-18.99-31.893-18.99-50.775v-645.53c0-49.515 67.21-38.395 99.287-38.395h663.46c30.873 0 68.7-5.97 98.949 2.345 38 10.45 24.934 90.773 24.934 118.533v226.166l0.005 354.545c0 33.013 51.2 33.013 51.2 0V270.095c0-37.524 7.49-86.953-6.605-122.88-22.446-57.21-77.399-56.325-127.8-56.325h-764.4c-50.883 0-87.578 40.453-90.22 89.544-0.533 9.907 0 19.994 0 29.911v613.837c0 18.16-0.236 35.277 6.605 52.715 13.972 35.62 48.814 56.33 86.323 56.33h794.757c54.467 0 98.243-32.025 101.345-89.543 1.772-33.014-49.438-32.84-51.205-0.005z","p-id":"4074"},null,-1),Q=n("path",{d:"M664.858 335.258c-1.485 45.875-36.163 80.547-82.033 82.032-45.86 1.485-80.625-38.39-82.033-82.032-1.484-45.865 38.39-80.625 82.033-82.033 45.86-1.485 80.625 38.39 82.033 82.033 1.065 32.931 52.27 33.034 51.2 0-2.402-74.215-59.024-130.837-133.233-133.233-74.173-2.401-130.95 62.633-133.233 133.233-2.401 74.173 62.633 130.949 133.233 133.232 74.173 2.402 130.95-62.633 133.233-133.232 1.07-33.035-50.135-32.927-51.2 0zM62.556 700.805L292.02 514.78h-36.203L701.26 904.714c24.73 21.653 61.092-14.413 36.198-36.198l-445.44-389.94c-11.346-9.932-24.796-9.246-36.203 0L26.353 664.607c-25.662 20.798 10.798 56.792 36.203 36.2z","p-id":"4075"},null,-1),R=n("path",{d:"M600.924 751.114L765.62 565.975h-36.198c78.244 75.372 156.493 150.733 234.747 226.1 23.777 22.901 60.021-13.262 36.198-36.2-78.244-75.37-156.493-150.732-234.747-226.098-9.595-9.247-26.798-10.573-36.198 0a2831453.414 2831453.414 0 0 0-164.695 185.139c-21.868 24.576 14.213 60.918 36.198 36.198z","p-id":"4076"},null,-1),W=[K,Q,R];function Y(e,a){return i(),r("svg",X,W)}var Z=z(P,[["render",Y]]);const x=V({name:"GUploadImage",components:{IconLink:J,IconImg:Z},props:{modelValue:{type:String,required:!0},allowType:{type:String,default:"gif|jpeg|jpg|png"},size:{type:Number,default:2},action:{type:String,default:D},previewHost:{type:String,default:N},label:{type:String,default:""},inline:{type:[Boolean,String],default:!1}},emits:[M],setup(e,a){const p=E(),m=h(!1),f=h({key:"",token:""}),g=h(!1),u=h(!1),_=async o=>{const d=T(o.file.file,{allowType:e.allowType,allowSize:e.size});if(d)return p.error(d),!1;try{return m.value=!0,f.value.token=await H(),f.value.key=`upload/${S()}_${o.file.name}`,!0}catch(F){m.value=!1,p.error(F.message)}return!1},w=o=>{m.value=!1;const d=JSON.parse(o.event.target.response);d.error?p.error(d.error):a.emit(M,`${e.previewHost}/${d.key}`)},v=o=>{a.emit(M,o)},y=()=>{const o=new Image;o.src=e.modelValue,o.onload=()=>{g.value=!1},o.onerror=()=>{g.value=!0,e.modelValue&&p.error("\u56FE\u7247\u52A0\u8F7D\u5931\u8D25")}},$=()=>{e.modelValue&&(u.value=!0)},I=()=>{u.value=!1},l=()=>{v(""),u.value=!1};return L(()=>e.modelValue,y),{loading:m,form:f,iserr:g,visibleCover:u,beforeUpload:_,finishUpload:w,handleInput:v,handleMouseEnter:$,handleMouseLeave:I,removeImage:l}}}),ee={class:"g-upload-image-content"},ae=["src"],oe={key:1,class:"g-upload-tip"},ne=n("div",null,"\u70B9\u51FB\u6216\u62D6\u62FD\u6587\u4EF6\u5230\u8FD9\u91CC\u66F4\u6362",-1),se={key:0,class:"g-upload-image-cover"},le=n("span",null,"\u66F4\u6539",-1),te=n("p",{style:{padding:"0 10px"}},"|",-1),ie={key:0,class:"g-input__caption"};function re(e,a,p,m,f,g){const u=t("IconLink"),_=t("n-icon"),w=t("n-input"),v=t("IconImg"),y=t("n-spin"),$=t("n-upload-dragger"),I=t("n-upload");return i(),r("div",{class:b(["datav-gui g-upload",[{"--inline --single":!!e.inline}]])},[s(w,{value:e.modelValue,size:"small",placeholder:"\u8BF7\u8F93\u5165\u56FE\u7247\u5730\u5740","onUpdate:value":e.handleInput},{prefix:c(()=>[s(_,null,{default:c(()=>[s(u)]),_:1})]),_:1},8,["value","onUpdate:value"]),s(I,{accept:"image/*",action:e.action,multiple:!1,"show-file-list":!1,data:e.form,onBeforeUpload:e.beforeUpload,onFinish:e.finishUpload},{default:c(()=>[s($,null,{default:c(()=>[s(y,{show:e.loading},{default:c(()=>[n("div",{class:"g-upload-image-wrap",onMouseenter:a[1]||(a[1]=(...l)=>e.handleMouseEnter&&e.handleMouseEnter(...l)),onMouseleave:a[2]||(a[2]=(...l)=>e.handleMouseLeave&&e.handleMouseLeave(...l))},[n("div",ee,[e.modelValue&&!e.iserr?(i(),r("img",{key:0,src:e.modelValue},null,8,ae)):(i(),r("div",oe,[s(_,{size:"60"},{default:c(()=>[s(v)]),_:1}),ne]))]),e.visibleCover?(i(),r("div",se,[le,te,n("span",{onClick:a[0]||(a[0]=C((...l)=>e.removeImage&&e.removeImage(...l),["stop"]))},"\u5220\u9664")])):B("",!0)],32)]),_:1},8,["show"])]),_:1})]),_:1},8,["action","data","onBeforeUpload","onFinish"]),e.label?(i(),r("span",ie,U(e.label),1)):B("",!0)],2)}var k=z(x,[["render",re]]);k.install=e=>{e.component(k.name,k)};export{k as default};
