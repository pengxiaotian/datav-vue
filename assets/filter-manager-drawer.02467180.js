import{b as P,I as j,H as p,z as c,a1 as B}from"./App.7d9600e2.js";import{I as z}from"./warning.d73c71b1.js";import{I as H}from"./document.e310dbca.js";import{F as L}from"./filter-collapse-panel.2744f764.js";import{a2 as O,a$ as U,bd as W,a7 as M,aA as I,aF as N,bh as v,a3 as l,a4 as F,a5 as A,b0 as f,aY as m,ab as h,af as $,a8 as T,ad as Y,ac as q,b7 as x,b1 as V}from"./vendor.577170a9.js";import"./arrow-left.723de3f7.js";import"./edit.3ff5df3e.js";import"./delete.dfde7a3e.js";import"./release.9cf26f04.js";const G=O({name:"FilterManagerDrawer",components:{IconDocument:H,FilterCollapsePanel:L},setup(){const n=U(),u=W(),_=M(!1),d=M(null);I(()=>j.filter.show,e=>{_.value=e}),I(_,e=>{e||(j.filter.show=!1)});const y=N(()=>p.dataFilters),b=N(()=>{const e=[...c.coms,...c.subComs],t=Object.create(null);return e.forEach(a=>{for(const s in a.apiData)a.apiData[s].pageFilters.forEach(o=>{t[o.id]?(t[o.id].ids.push(a.id),t[o.id].names.push(a.alias)):t[o.id]={ids:[a.id],names:[a.alias]}})}),t}),D=()=>{d.value||(d.value={id:0,name:"\u65B0\u5EFA\u8FC7\u6EE4\u5668",code:"return data;",origin:"return data;",projectId:0,createAt:"",updateAt:""})},C=(e,t)=>{const a=e.trim();a&&t.name!==a&&(t.name=a,t.id>0&&p.updateFilterName(t))},E=e=>{if(e>0){const t=u.create({content:"\u662F\u5426\u5220\u9664\u6570\u636E\u8FC7\u6EE4\u5668\uFF0C\u53EF\u80FD\u5BFC\u81F4\u76F8\u5173\u7EC4\u4EF6\u4E0D\u53EF\u7528\u3002",negativeText:"\u53D6\u6D88",positiveText:"\u786E\u5B9A",iconPlacement:"top",icon:()=>x(z),onPositiveClick:async()=>{t.loading=!0;try{await p.deleteFilter(e);const a=b.value[e];a&&[...c.coms,...c.subComs].filter(r=>a.ids.includes(r.id)).forEach(r=>{for(const o in r.apiData){const i=r.apiData[o],g=i.pageFilters.find(k=>k.id===e);i.pageFilters=i.pageFilters.filter(k=>k.id!==e),g&&g.enabled&&B(r.id,o,r.apis[o],i)}})}catch(a){n.error(a.message)}}})}else d.value=null},w=async e=>{if(e.id>0){await p.updateFilter(e);const t=b.value[e.id];t&&[...c.coms,...c.subComs].filter(s=>t.ids.includes(s.id)).forEach(s=>{for(const r in s.apiData){const o=s.apiData[r],i=o.pageFilters.find(g=>g.id===e.id);i&&i.enabled&&B(s.id,r,s.apis[r],o)}})}else await p.createFilter(e),d.value=null};return v("usedFilters",b),v("editFilterName",C),v("removeFilter",E),v("saveFilter",w),{visible:_,dataFilters:y,newDataFilter:d,addFilter:D,removeFilter:E}}}),J={class:"filter-manager-title"},K=V(" \u6570\u636E\u8FC7\u6EE4\u5668"),Q=h("span",null,"\u5E2E\u52A9\u6587\u6863",-1),R={key:1,class:"panel-info"},S=h("p",{class:"info-text"},"\u8FC7\u6EE4\u5668\u5217\u8868\u4E3A\u7A7A\uFF0C\u8BF7\u521B\u5EFA\u540E\u4F7F\u7528",-1),X=V(" \u65B0\u5EFA ");function Z(n,u,_,d,y,b){const D=l("IconDocument"),C=l("n-icon"),E=l("router-link"),w=l("filter-collapse-panel"),e=l("n-button"),t=l("n-drawer-content"),a=l("n-drawer");return F(),A(a,{show:n.visible,"onUpdate:show":u[1]||(u[1]=s=>n.visible=s),width:"500px",placement:"left",class:"filter-manager-drawer",to:"#edit-main-wp"},{default:f(()=>[m(t,{closable:""},{header:f(()=>[h("p",J,[K,h("span",{class:"create-filter",onClick:u[0]||(u[0]=(...s)=>n.addFilter&&n.addFilter(...s))},"\u65B0\u5EFA"),m(E,{to:{name:"MyCase"},target:"_blank",rel:"noopener noreferrer",class:"filter-doc"},{default:f(()=>[m(C,null,{default:f(()=>[m(D)]),_:1}),Q]),_:1})])]),default:f(()=>[n.newDataFilter?(F(),A(w,{key:0,"data-filter":n.newDataFilter,"is-new":!0,draggable:!1,"has-feedback":!1,removable:!0},null,8,["data-filter"])):$("",!0),(F(!0),T(q,null,Y(n.dataFilters,s=>(F(),A(w,{key:s.id,"data-filter":s,draggable:!1,"has-feedback":!1,publish:!0,removable:!0,"show-time":!0},null,8,["data-filter"]))),128)),n.dataFilters.length===0&&!n.newDataFilter?(F(),T("div",R,[S,m(e,{focusable:!1,onClick:n.addFilter},{default:f(()=>[X]),_:1},8,["onClick"])])):$("",!0)]),_:1})]),_:1},8,["show"])}var ue=P(G,[["render",Z]]);export{ue as default};
